<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- saved from url=(0085)https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/5?q=node/10 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><script type="text/javascript">window["_gaUserPrefs"] = { ioo : function() { return true; } }</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<script type="text/javascript" src="https://web.archive.org/static/js/analytics.js"></script><style>#content > #right > .dose > .dosesingle,
#content > #center > .dose > .dosesingle
{display:none !important;}</style>
<script type="text/javascript">archive_analytics.values.server_name="wwwb-app10.us.archive.org";archive_analytics.values.server_ms=352;</script>
<link type="text/css" rel="stylesheet" href="./PHP _ FastCGI -_files/banner-styles.css">


<title>PHP | FastCGI - </title>

<link type="text/css" rel="stylesheet" media="all" href="./PHP _ FastCGI -_files/node.css">
<link type="text/css" rel="stylesheet" media="all" href="./PHP _ FastCGI -_files/defaults.css">
<link type="text/css" rel="stylesheet" media="all" href="./PHP _ FastCGI -_files/system.css">
<link type="text/css" rel="stylesheet" media="all" href="./PHP _ FastCGI -_files/system-menus.css">
<link type="text/css" rel="stylesheet" media="all" href="./PHP _ FastCGI -_files/user.css">
<link type="text/css" rel="stylesheet" media="all" href="./PHP _ FastCGI -_files/style.css">
</head>
<body><div id="wm-ipp" lang="en" style="display: block;" class="hi">

<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
   <table style="width:100%;"><tbody><tr>
   <td id="wm-logo">
       <a href="https://web.archive.org/web/" title="Wayback Machine home page"><img src="./PHP _ FastCGI -_files/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"></a>
   </td>
   <td class="c">
       <table style="margin:0 auto;"><tbody><tr>
       <td class="u" colspan="2">
       <form target="_top" method="get" action="https://web.archive.org/web/form-submit.jsp" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://fastcgi.com/drupal/node/5?q=node/10" style="width:400px;" onfocus="this.focus();this.select();"><input type="hidden" name="type" value="replay"><input type="hidden" name="date" value="20160304171005"><input type="submit" value="Go"><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td class="n" rowspan="2">
           <table><tbody>
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr class="m">
           	<td class="b" nowrap="nowrap">
		
		    <a href="https://web.archive.org/web/20160131004302/http://www.fastcgi.com/drupal/node/5?q=node/10" title="31 janv. 2016">JANV.</a>
		
		</td>
		<td class="c" id="displayMonthEl" title="You are here: 17:10:05 mars 4, 2016">Mar</td>
		<td class="f" nowrap="nowrap">
		
		    avr.
		
                </td>
	    </tr>
           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr class="d">
               <td class="b" nowrap="nowrap">
               
                   <a href="https://web.archive.org/web/20160131004302/http://www.fastcgi.com/drupal/node/5?q=node/10" title="0:43:02 janv. 31, 2016"><img src="./PHP _ FastCGI -_files/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0"></a>
               
               </td>
               <td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 17:10:05 mars 4, 2016">4</td>
	       <td class="f" nowrap="nowrap">
               
                   <img src="./PHP _ FastCGI -_files/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0">
               
	       </td>
           </tr>
           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr class="y">
	       <td class="b" nowrap="nowrap">
               
                   <a href="https://web.archive.org/web/20150221085432/http://www.fastcgi.com/drupal/node/5?q=node/10" title="21 févr. 2015"><strong>2015</strong></a>
               
               </td>
               <td class="c" id="displayYearEl" title="You are here: 17:10:05 mars 4, 2016">2015</td>
	       <td class="f" nowrap="nowrap">
               
                   2017
               
	       </td>
           </tr>
           </tbody></table>
       </td>
       </tr>
       <tr>
       <td class="s">
           <a class="t" href="https://web.archive.org/web/20160304171005*/http://fastcgi.com/drupal/node/5?q=node/10" title="See a list of every capture for this URL">131 captures</a>
           <div class="r" title="Timespan for captures of this URL">20 sept. 08 - 4 mars 16</div>
       </td>
       <td class="k">
       <a href="https://web.archive.org/web/20150315000000/http://fastcgi.com/drupal/node/5?q=node/10" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" title="Explore captures for this URL">
	 <img id="sparklineImgId" alt="sparklines" onmouseover="__wm.st(1)" onmouseout="__wm.st(0)" onmousemove="__wm.mv(event,this)" width="525" height="27" border="0" src="./PHP _ FastCGI -_files/graph.jsp">
       <div class="yt" style="display: inline; width: 25px; height: 27px; left: 475px;"></div><div class="mt" style="display: inline; width: 2px; height: 27px; left: 480px;"></div></div>
       </a>
       </td>
       </tr></tbody></table>
   </td>
   <td class="r">
       <a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/5?q=node/10#close" onclick="__wm.h();return false;" style="background-image:url(/static/images/toolbar/wm_tb_close.png);top:5px;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="background-image:url(/static/images/toolbar/wm_tb_help.png);bottom:5px;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>
</div>
</div>
</div>


<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="./PHP _ FastCGI -_files/disclaim-element.js"></script>
<script type="text/javascript" src="./PHP _ FastCGI -_files/graph-calc.js"></script>
<script type="text/javascript">//<![CDATA[
var __wm = (function(imgWidth,imgHeight,yearImgWidth,monthImgWidth){
var wbPrefix = "/web/";
var wbCurrentUrl = "http://fastcgi.com/drupal/node/5?q=node/10";

var firstYear = 1996;
var displayDay = "4";
var displayMonth = "mars";
var displayYear = "2016";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var $D=document,$=function(n){return document.getElementById(n)};
var trackerVal,curYear = -1,curMonth = -1;
var yearTracker,monthTracker;
function showTrackers(val) {
  if (val===trackerVal) return;
  var $ipp=$("wm-ipp");
  var $y=$("displayYearEl"),$m=$("displayMonthEl"),$d=$("displayDayEl");
  if (val) {
    $ipp.className="hi";
  } else {
    $ipp.className="";
    $y.innerHTML=displayYear;$m.innerHTML=displayMonth;$d.innerHTML=displayDay;
  }
  yearTracker.style.display=val?"inline":"none";
  monthTracker.style.display=val?"inline":"none";
  trackerVal = val;
}
function trackMouseMove(event,element) {
  var eventX = getEventX(event);
  var elementX = getElementX(element);
  var xOff = Math.min(Math.max(0, eventX - elementX),imgWidth);
  var monthOff = xOff % yearImgWidth;

  var year = Math.floor(xOff / yearImgWidth);
  var monthOfYear = Math.min(11,Math.floor(monthOff / monthImgWidth));
  // 1 extra border pixel at the left edge of the year:
  var month = (year * 12) + monthOfYear;
  var day = monthOff % 2==1?15:1;
  var dateString = zeroPad(year + firstYear) + zeroPad(monthOfYear+1,2) +
    zeroPad(day,2) + "000000";

  $("displayYearEl").innerHTML=year+firstYear;
  $("displayMonthEl").innerHTML=prettyMonths[monthOfYear];
  // looks too jarring when it changes..
  //$("displayDayEl").innerHTML=zeroPad(day,2);
  var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
  $("wm-graph-anchor").href=url;

  if(curYear != year) {
    var yrOff = year * yearImgWidth;
    yearTracker.style.left = yrOff + "px";
    curYear = year;
  }
  if(curMonth != month) {
    var mtOff = year + (month * monthImgWidth) + 1;
    monthTracker.style.left = mtOff + "px";
    curMonth = month;
  }
}
function hideToolbar() {
  $("wm-ipp").style.display="none";
}
function bootstrap() {
  var $spk=$("wm-ipp-sparkline");
  yearTracker=$D.createElement('div');
  yearTracker.className='yt';
  with(yearTracker.style){
    display='none';width=yearImgWidth+"px";height=imgHeight+"px";
  }
  monthTracker=$D.createElement('div');
  monthTracker.className='mt';
  with(monthTracker.style){
    display='none';width=monthImgWidth+"px";height=imgHeight+"px";
  }
  $spk.appendChild(yearTracker);
  $spk.appendChild(monthTracker);

  var $ipp=$("wm-ipp");
  $ipp&&disclaimElement($ipp);
}
return{st:showTrackers,mv:trackMouseMove,h:hideToolbar,bt:bootstrap};
})(525, 27, 25, 2);//]]>
</script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
</style>

<script type="text/javascript">__wm.bt();</script>
<!-- END WAYBACK TOOLBAR INSERT -->





<div id="wrapper">
	<div id="logo"></div>
	<div id="nav">
		<ul class="nav-links primary-nav-links"><li class="menu-49 first"><a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/2">FastCGI</a></li>
<li class="menu-53"><a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/19">News</a></li>
<li class="menu-45"><a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/6">Documentation</a></li>
<li class="menu-44"><a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/5">API/Libraries</a></li>
<li class="menu-43"><a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/3">FastCGI Servers</a></li>
<li class="menu-46"><a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/7">Misc.</a></li>
<li class="menu-48"><a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/12">Help!</a></li>
<li class="menu-47 last"><a href="https://web.archive.org/web/20160304171005/http://fastcgi.com/drupal/node/8">About Us</a></li>
</ul>		</div>
	<div id="heading">
		PHP	</div> <!-- end heading -->
	<div id="content">
												<div id="node-10" class="node">



  
  <div class="content">
    <p><strong>Does PHP work with FastCGI?</strong></p>
<p>Yes! As a matter of fact, you can set up multiple versions of PHP, and also utilize suexec to support different users with their own instances of PHP. It reduces the memory footprint of your web server, but still gives you the speed and power of the entire PHP language.<br>
Build PHP</p>
<p>First of all, build PHP. All of versions 4 and versions 5 supports the FastCGI flag. Simply specify where to get the FastCGI libraries from (download and install them from the <a href="https://web.archive.org/web/20160304171005/http://www.fastcgi.com/" title="http://www.fastcgi.com">http://www.fastcgi.com</a> website), and do the normal build with whatever other options you require:</p>
<p><code>./configure [ your options ] --with-fastcgi=/usr/local</code></p>
<p>This creates a version of PHP which speaks the FastCGI protocol. Unfortunately, depending on which version of PHP you are running, you may have one or two versions which run the FastCGI protocol.  In particular:</p>
<p></p><ul><br>
<li>Older 4.X versions produce a binary which <em>only</em> runs FastCGI<br>
</li><li>Newer 4.X versions and the 5.0.X and 5.1.X versions produce a binary which runs both regular and FastCGI versions<br>
5.2.3 introduced two versions again - a php and php-cgi binary.  The php-cgi binary is the one you want<br>
</li></ul><p></p>
<p><strong>Configure Part #1 (Apache 1.X)</strong></p>
<p>Setting up Apache to use PHP is similar to the normal configuration. Simply add the following lines to your httpd.conf, either in a VirtualHost directive, or in the main context:</p>
<p>    FastCgiServer /export/httpd/cgi-bin/php<br>
    AddHandler php-fastcgi .php</p>
<p>        SetHandler fastcgi-script</p>
<p>    Action php-fastcgi /cgi-bin/php<br>
    DirectoryIndex index.html index.shtml index.cgi index.php<br>
    AddType application/x-httpd-php .php</p>
<p>Finally, copy or hard link your PHP binary from wherever you installed it to /export/httpd/cgi-bin/php. Now there is something there to run.</p>
<p>These lines set up the Web server to pass requests for things of type .php to your FastCgiServer for processing. It also enables index.php as a directory index.</p>
<p><strong>Configure Part #2</strong></p>
<p>PHP can run in two modes - as a normal FastCGI application, and also bypassing the normal FastCGI process manager, using its own system to control how many copies of the PHP binary are running.  The default mode is to run it's own process manager, bringing up 8 by default.</p>
<p>Depending on your configuration, you may want to pre-fork threads with the FastCGI process manager, or else run it as a typical dynamic application.  Since you'll want to set environment variables, and those can't easily be set for FastCGI, I usually install a tiny shell script with configuration variables in it into the cgi-bin directory and have it run PHP instead:</p>
<p><code><br>
    #!/bin/sh</code></p>
<p>    PHPRC="/usr/local/etc/php/client"<br>
    export PHPRC<br>
    PHP_FCGI_CHILDREN=4<br>
    export PHP_FCGI_CHILDREN<br>
    exec /usr/local/bin/php-fcgi<br>
</p>
<p>This script lets you set a specific .ini file. In the example, PHP will read in /usr/local/etc/php/client/php.ini for configuration parameters. The number of running children is controlled by the PHP_FCGI_CHILDREN variable.  If this is set to 0, then PHP will not fork a process manager but instead run only as a worker thread.  If you are worried about memory leaks (memory leaks? In PHP?) then you can set PHP_FCGI_MAX_REQUESTS, to cause worker children to exit after that many requests.</p>
<p>A script like this also lets you easily control which versions you're running - on our servers, we might have three, four, or more versions running all at the same time.  This is very handy when testing upgrades, because you don't have to touch the web server across the board, only on a per-domain basis.</p>
<p>The README.FastCGI file, located in the PHP source, provides additional details on these and some other useful variables.</p>
<p><strong>Confusing FastCGI and PHP Process Managers</strong></p>
<p>One of the problems people seem to run into most often is when you have competing process managers - if you run with both PHP and FastCGI thinking they are responsible for spawning worker threads, you will have a train wreck!</p>
<p><strong>Some Last Notes</strong></p>
<p></p><ul><br>
<li>If you are using a dynamic application environment, make sure that PHP_FCGI_CHILDREN is always set to 0; that way, PHP will never try to manage worker threads.<br>
</li><li>If you are using a static environment, decide where you're going to control it and make it clear in the comments in your httpd.conf so you remember six months later!<br>
</li><li>Don't make too many PHP threads; usually your machine will die of CPU overload if you try to do too much work in the threads; allow httpd to buffer the network requests.  More worker threads and CPU threads in your machine is usually counter-productive.<br>
</li><li>Don't put "callout" code into your PHP threads - that means, don't have a PHP script make an http call to an external source (or back to itself).  You'll end up with threads that are just sitting around waiting, rather than processing.  You can even get into a deadlock if you make a call back to the web server that the PHP process itself is serving - you'll run out of threads, possible, and then the web server will grind to a halt!<br>
</li></ul><p></p>
  </div>

  <div class="clear-block clear">
    <div class="meta">
    
    </div>

      </div>

</div>	</div> <!-- end content -->
	<div id="footer">
		© Copyright 1996 - 2014 Open Market, Rob Saccoccio &amp; others, All rights reserved. <a href="https://web.archive.org/web/20160304171005/http://www.cosmicsitedesign.com/">Web design</a> by CosmicSiteDesign.com
	</div> <!-- end footer -->
</div> <!-- end wrapper -->








<!--
     FILE ARCHIVED ON 17:10:05 mars 4, 2016 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 16:03:37 avr. 10, 2016.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
</body></html>